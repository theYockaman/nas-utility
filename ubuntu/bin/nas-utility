#!/usr/bin/env bash

set -euo pipefail
IFS=$'\n\t'

# ----------------------
# Helper Functions
# ----------------------
$APP_NAME="nas-utility"
source "/usr/local/lib/$APP_NAME/utils.sh"


# ----------------------
# Main Menu Function
# ----------------------
main_menu() {

    while true; do
        CHOICE=$(whiptail --title "Select an Action" --menu "Choose an option:" 20 60 10 \
            "Install Menu" "" \
            "Exit" "" \
            3>&1 1>&2 2>&3)

        exitstatus=$?
        if [ $exitstatus -ne 0 ] || [ -z "$CHOICE" ]; then
            echo "No selection made. Exiting."
            break
        fi

        case "$CHOICE" in
            "Install Menu") install_menu ;;
            "Uninstall Menu") uninstall_menu ;;
            "Delete") delete_app ;;
            "Exit") exit_program ;;
            *) whiptail --title "Error" --msgbox "Invalid option selected!" 10 50 ;;
        esac
    done
}







# ----------------------
# Entry Point
# ----------------------
main() {

    if [ $# -ge 1 ]; then
        case $1 in
            "install")
                install_menu $2 
                ;;


            "delete")
                delete_app &
                ;;
            "quit")
                exit 0
                ;;
            *)
                echo "Unknown command: $1"
                exit 1
                ;;
        esac
    else
        # Check if Whiptail is installed
        if ! command -v whiptail &> /dev/null; then
            sudo apt update
            sudo apt install whiptail -y
        fi

        main_menu

    fi
}

main "$@"